{
  "rules": {
    // Users collection - user can read/write own data, others can read status
    "users": {
      "$uid": {
        ".read": true,
        ".write": "auth != null && auth.uid == $uid",
        "status": {
          ".read": true
        },
        "lastActive": {
          ".read": true
        }
      }
    },
    
    // Phone index for contact matching - read only for authenticated users
    "phoneIndex": {
      ".read": "auth != null",
      "$phone": {
        ".write": "auth != null"
      }
    },
    
    // Buddies - mutual friend connections
    "buddies": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null",
        "$buddyId": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    },
    
    // Buddy requests - pending friend invitations
    "buddy_requests": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null",
        "$requestId": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    },
    
    // Notifications - in-app notifications per user
    "notifications": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null",
        "$notificationId": {
          ".read": "auth != null && auth.uid == $userId",
          ".write": "auth != null"
        }
      }
    },
    
    // Game rooms - participants can read/write
    "game_rooms": {
      "$roomId": {
        ".read": true,
        ".write": true,
        ".validate": "newData.hasChildren(['roomCode', 'hostId', 'status'])"
      }
    },
    
    // Shopping game rooms - participants can read/write
    "shopping_rooms": {
      "$roomId": {
        ".read": true,
        ".write": true,
        ".validate": "newData.hasChildren(['roomCode', 'hostId', 'phase'])"
      }
    },
    
    // Invites - sender/receiver can read/write their invites
    "invites": {
      "outgoing": {
        "$userId": {
          ".read": "auth != null && auth.uid == $userId",
          ".write": "auth != null && auth.uid == $userId",
          "$inviteId": {
            ".read": "auth != null",
            ".write": "auth != null"
          }
        }
      },
      "incoming": {
        "$userId": {
          ".read": "auth != null && auth.uid == $userId",
          ".write": "auth != null",
          "$inviteId": {
            ".read": "auth != null",
            ".write": "auth != null"
          }
        }
      }
    },
    
    // Voice notes storage metadata
    "voice_notes": {
      "$roomId": {
        ".read": true,
        ".write": "auth != null"
      }
    },
    
    // Voice rooms for WebRTC P2P signaling
    "voice_rooms": {
      "$roomId": {
        ".read": "auth != null",
        ".write": "auth != null",
        "participants": {
          "$userId": {
            ".read": "auth != null",
            ".write": "auth != null && auth.uid == $userId"
          }
        },
        "signals": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    }
  }
}